<div class="member-profile-container">
  <div class="header-section">
    <h1>My Profile</h1>
    <p>Manage your personal information and view your community statistics</p>
  </div>

  <div class="profile-content">
    <!-- Left Column - Profile Information -->
    <div class="profile-left">
      <mat-card class="profile-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>person</mat-icon>
            Personal Information
          </mat-card-title>
          <button mat-raised-button color="primary" (click)="isEditing ? saveProfile() : toggleEdit()"
            [disabled]="isEditing && !profileForm.valid" [class]="isEditing ? 'save-btn' : 'edit-btn'">
            <mat-icon>{{ isEditing ? 'save' : 'edit' }}</mat-icon>
            {{ isEditing ? 'Save Changes' : 'Edit Profile' }}
          </button>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="profileForm" class="profile-form">
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Full Name</mat-label>
                <input matInput formControlName="name" [readonly]="!isEditing">
                <mat-icon matSuffix>person</mat-icon>
                <mat-error *ngIf="profileForm.get('name')?.hasError('required')">
                  Name is required
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email" type="email" [readonly]="!isEditing">
                <mat-icon matSuffix>email</mat-icon>
                <mat-error *ngIf="profileForm.get('email')?.hasError('required')">
                  Email is required
                </mat-error>
                <mat-error *ngIf="profileForm.get('email')?.hasError('email')">
                  Please enter a valid email
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Phone Number</mat-label>
                <input matInput formControlName="phone" [readonly]="!isEditing">
                <mat-icon matSuffix>phone</mat-icon>
                <mat-error *ngIf="profileForm.get('phone')?.hasError('required')">
                  Phone number is required
                </mat-error>
                <mat-error *ngIf="profileForm.get('phone')?.hasError('pattern')">
                  Please enter a valid 10-digit phone number
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Community Unit</mat-label>
                <input matInput formControlName="communityUnit" [readonly]="!isEditing">
                <mat-icon matSuffix>location_city</mat-icon>
                <mat-error *ngIf="profileForm.get('communityUnit')?.hasError('required')">
                  Community unit is required
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Address</mat-label>
                <textarea matInput formControlName="address" rows="2" [readonly]="!isEditing"></textarea>
                <mat-icon matSuffix>home</mat-icon>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Emergency Contact</mat-label>
                <input matInput formControlName="emergencyContact" [readonly]="!isEditing">
                <mat-icon matSuffix>contact_emergency</mat-icon>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Occupation</mat-label>
                <input matInput formControlName="occupation" [readonly]="!isEditing">
                <mat-icon matSuffix>work</mat-icon>
              </mat-form-field>
            </div>

            <div *ngIf="isEditing" class="form-actions">
              <button mat-stroked-button type="button" (click)="toggleEdit()">
                <mat-icon>cancel</mat-icon>
                Cancel
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Right Column - Statistics -->
    <div class="profile-right">
      <!-- Community Statistics -->
      <mat-card class="stats-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>analytics</mat-icon>
            Community Statistics
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stats-grid">
            <div class="stat-item">
              <mat-icon class="stat-icon">event</mat-icon>
              <div class="stat-details">
                <h3>{{ profileStats.totalMeetings }}</h3>
                <p>Total Meetings</p>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon class="stat-icon">check_circle</mat-icon>
              <div class="stat-details">
                <h3>{{ profileStats.meetingsAttended }}</h3>
                <p>Meetings Attended</p>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon class="stat-icon">trending_up</mat-icon>
              <div class="stat-details">
                <h3>{{ getAttendancePercentage() }}%</h3>
                <p>Attendance Rate</p>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon class="stat-icon">account_balance</mat-icon>
              <div class="stat-details">
                <h3>{{ profileStats.totalLoans }}</h3>
                <p>Total Loans</p>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Financial Overview -->
      <mat-card class="financial-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>payments</mat-icon>
            Financial Overview
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="financial-stats">
            <div class="financial-item">
              <div class="financial-info">
                <mat-icon class="financial-icon">account_balance_wallet</mat-icon>
                <div>
                  <h4>Total Paid</h4>
                  <p class="amount">{{ getFormattedAmount(profileStats.totalPaid) }}</p>
                </div>
              </div>
            </div>
            <div class="financial-item">
              <div class="financial-info">
                <mat-icon class="financial-icon">pending</mat-icon>
                <div>
                  <h4>Pending Payments</h4>
                  <p class="amount pending">{{ getFormattedAmount(profileStats.pendingPayments) }}</p>
                </div>
              </div>
            </div>
            <div class="financial-item">
              <div class="financial-info">
                <mat-icon class="financial-icon">credit_card</mat-icon>
                <div>
                  <h4>Active Loans</h4>
                  <p class="loans-count">{{ profileStats.activeLoans }}</p>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Quick Actions -->
      <mat-card class="actions-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>flash_on</mat-icon>
            Quick Actions
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="quick-actions">
            <button mat-stroked-button class="action-btn" routerLink="/kudumbashree/payments">
              <mat-icon>receipt</mat-icon>
              View Payment History
            </button>
            <button mat-stroked-button class="action-btn" routerLink="/kudumbashree/loans">
              <mat-icon>account_balance</mat-icon>
              Manage Loans
            </button>
            <button mat-stroked-button class="action-btn" routerLink="/kudumbashree/attendance">
              <mat-icon>fingerprint</mat-icon>
              Mark Attendance
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>